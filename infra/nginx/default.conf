server {
  listen 80;

  # ALB health check
  location = /health {
    return 200 "ok";
    add_header Content-Type text/plain;
  }

  # Frontend
  location / {
    proxy_pass http://web:3009;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

    # APIs (support /service and /service/)
  location = /auth { proxy_pass http://auth-service:3000/auth; }
  location /auth/ { proxy_pass http://auth-service:3000/; }

  location = /attendance { proxy_pass http://attendance-service:3002/attendance; }
  location /attendance/ { proxy_pass http://attendance-service:3002/; }

  location = /tracking { proxy_pass http://tracking-service:3003/tracking; }
  location /tracking/ { proxy_pass http://tracking-service:3003/; }

  location = /notifications { proxy_pass http://notifications-service:3004/notifications; }
  location /notifications/ { proxy_pass http://notifications-service:3004/; }

  location = /children { proxy_pass http://children-service:3005/children; }
  location /children/ { proxy_pass http://children-service:3005/; }

  location = /tutors { proxy_pass http://tutors-service:3006/tutors; }
  location /tutors/ { proxy_pass http://tutors-service:3006/; }

  location = /staff { proxy_pass http://staff-service:3007/staff; }
  location /staff/ { proxy_pass http://staff-service:3007/; }

  location = /files { proxy_pass http://files-service:3008/files; }
  location /files/ { proxy_pass http://files-service:3008/; }

}
